# Re-Fit AI Service

AI ê¸°ë°˜ ë©˜í† -ë©˜í‹° ë§¤ì¹­ ë° ì¶”ì²œ ì„œë¹„ìŠ¤

---

## ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
19-team-project-ai/
â”œâ”€â”€ ai_app/              # FastAPI ì• í”Œë¦¬ì¼€ì´ì…˜
â”‚   â”œâ”€â”€ api/            # API ì—”ë“œí¬ì¸íŠ¸
â”‚   â”œâ”€â”€ controllers/    # ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
â”‚   â”œâ”€â”€ services/       # ì„œë¹„ìŠ¤ ë ˆì´ì–´
â”‚   â””â”€â”€ adapters/       # ì™¸ë¶€ ì—°ë™
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â”œâ”€â”€ ci.yml      # CI íŒŒì´í”„ë¼ì¸
â”‚       â”œâ”€â”€ cd.yml      # CD íŒŒì´í”„ë¼ì¸
â”‚       â””â”€â”€ rollback.yml # ë¡¤ë°± ì›Œí¬í”Œë¡œìš°
â”œâ”€â”€ scripts/            # ìœ í‹¸ë¦¬í‹° ìŠ¤í¬ë¦½íŠ¸
â”œâ”€â”€ pyproject.toml      # Python í”„ë¡œì íŠ¸ ì„¤ì • (ë‹¨ì¼ ì†ŒìŠ¤)
â””â”€â”€ requirements.txt    # íŒ€ì› ì°¸ì¡°ìš© (ìë™ ë™ê¸°í™”)
```

---

## ğŸš€ ë°°í¬ í”„ë¡œì„¸ìŠ¤

### **CI/CD íŒŒì´í”„ë¼ì¸**

```
PR ìƒì„±
    â†“
[CI] Lint & Test (PR only)
    â†“
ë¨¸ì§€ to develop
    â†“
[CI] Integration Test
    â†“
[CI] Wheel ë¹Œë“œ & S3 ì—…ë¡œë“œ
    â†“
[CD] íŠ¸ë¦¬ê±° (ìë™)
    â†“
[CD] ë°°í¬ to EC2
    â†“
í—¬ìŠ¤ì²´í¬ & Discord ì•Œë¦¼
```

### **ë°°í¬ ë‹¨ê³„ (CD)**

1. **ë°±ì—… ìƒì„±**
   - ì½”ë“œ ë°±ì—…: `/backups/ai/code_YYYYMMDDHHMMSS/`
   - Wheel ë°±ì—…: `/backups/ai/wheel_YYYYMMDDHHMMSS/`

2. **Wheel íŒ¨í‚¤ì§€ ì„¤ì¹˜**
   - S3ì—ì„œ ë‹¤ìš´ë¡œë“œ
   - `pip install --force-reinstall --no-cache-dir`

3. **ì„œë¹„ìŠ¤ ì¬ì‹œì‘**
   - PM2 í”„ë¡œì„¸ìŠ¤ ì •ë¦¬
   - PM2 ì¬ì‹œì‘
   - Caddy ë¦¬ë¡œë“œ

4. **í—¬ìŠ¤ì²´í¬**
   - ìµœëŒ€ 5íšŒ ì¬ì‹œë„
   - ì‹¤íŒ¨ ì‹œ ìë™ ë¡¤ë°±

---

## ğŸ”„ ë¡¤ë°± ì‹œìŠ¤í…œ

### **ë¡¤ë°± ì›Œí¬í”Œë¡œìš° ì‚¬ìš©ë²•**

#### **1ï¸âƒ£ ë°±ì—… ëª©ë¡ ì¡°íšŒ**

```bash
# GitHub Actions â†’ AI Service Rollback ì›Œí¬í”Œë¡œìš° ì„ íƒ
# Mode: list ì„ íƒ
```

**ì¶œë ¥ ì˜ˆì‹œ:**
```
ğŸ“‚ Available Code Backups (Latest 10):
  - code_20260128100000 (Jan 28 10:00)
  - code_20260127150000 (Jan 27 15:00)
  ...

ğŸ“¦ Available Wheel Backups (Latest 10):
  - wheel_20260128100000 (Jan 28 10:00)
  - wheel_20260127150000 (Jan 27 15:00)
  ...
```

#### **2ï¸âƒ£ íŠ¹ì • ë²„ì „ìœ¼ë¡œ ë¡¤ë°±**

```bash
# GitHub Actions â†’ AI Service Rollback ì›Œí¬í”Œë¡œìš° ì„ íƒ
# Mode: restore
# Backup ID: 20260127150000  (ë˜ëŠ” code_20260127150000)
# Restore dependencies: true
```

#### **3ï¸âƒ£ ìµœì‹  ë°±ì—…ìœ¼ë¡œ ê¸´ê¸‰ ë¡¤ë°±**

```bash
# Backup IDë¥¼ ë¹„ì›Œë‘ë©´ ìë™ìœ¼ë¡œ ìµœì‹  ë°±ì—… ì‚¬ìš©
# Mode: restore
# Backup ID: (ë¹„ì›€)
# Restore dependencies: true
```

### **ë¡¤ë°± ì˜µì…˜**

| ì˜µì…˜ | ì„¤ëª… | ì¶”ì²œ |
|------|------|------|
| **Restore dependencies: true** | ì½”ë“œ + Wheel íŒ¨í‚¤ì§€ ëª¨ë‘ ë³µì› | âœ… ì¶”ì²œ (ì™„ì „ ë³µêµ¬) |
| **Restore dependencies: false** | ì½”ë“œë§Œ ë³µì›, í˜„ì¬ venv ìœ ì§€ | âš ï¸ ì˜ì¡´ì„± í˜¸í™˜ í™•ì¸ í•„ìš” |

### **ë¡¤ë°± í”„ë¡œì„¸ìŠ¤**

```
ë¡¤ë°± ì‹œì‘
    â†“
Safety Backup ìƒì„± (í˜„ì¬ ìƒíƒœ ì„ì‹œ ë°±ì—…)
    â†“
PM2 í”„ë¡œì„¸ìŠ¤ ì™„ì „ ì •ë¦¬
    â†“
ì½”ë“œ ë³µì› (ai_app, pyproject.toml, requirements.txt)
    â†“
ì˜ì¡´ì„± ë³µì› (ì„ íƒì , wheel ì¬ì„¤ì¹˜)
    â†“
PM2 ì¬ì‹œì‘
    â†“
í—¬ìŠ¤ì²´í¬ (ìµœëŒ€ 10íšŒ, ì ì§„ì  ëŒ€ê¸°)
    â†“
ì„±ê³µ â†’ Safety backup ì‚­ì œ
ì‹¤íŒ¨ â†’ Safety backupìœ¼ë¡œ ìë™ ë³µêµ¬ ì‹œë„
```

### **ë‹¤ë‹¨ê³„ ë³µêµ¬ ì „ëµ**

1. **Level 1**: ì§€ì •ëœ ë°±ì—…ìœ¼ë¡œ ë¡¤ë°±
2. **Level 2**: í—¬ìŠ¤ì²´í¬ ì‹¤íŒ¨ ì‹œ, Safety backupìœ¼ë¡œ ë³µêµ¬
3. **Level 3**: ëª¨ë“  ì‹œë„ ì‹¤íŒ¨ ì‹œ, ìˆ˜ë™ ê°œì… í•„ìš” (ìƒì„¸ ë¡œê·¸ ì œê³µ)

---

## ğŸ”§ ì˜ì¡´ì„± ê´€ë¦¬

### **pyproject.toml (ë‹¨ì¼ ì†ŒìŠ¤)**

- **CI/CDì—ì„œ ì‚¬ìš©**: `python -m build --wheel`
- **ì˜ì¡´ì„± ì¶”ê°€**: `[project].dependencies`ì— ì§ì ‘ ì¶”ê°€
- **ì˜ˆì‹œ**:
  ```toml
  dependencies = [
      "fastapi>=0.109.0",
      "sentence-transformers>=2.2.0",
      ...
  ]
  ```

### **requirements.txt (íŒ€ì› ì°¸ì¡°ìš©)**

- **ë¡œì»¬ ê°œë°œ**: `pip install -r ai_app/requirements.txt`
- **ìë™ ë™ê¸°í™”**: CIì—ì„œ pyproject.tomlê³¼ ìë™ ë™ê¸°í™”
- **ìˆ˜ë™ ì—…ë°ì´íŠ¸ ê¸ˆì§€**: pyproject.tomlì—ì„œë§Œ ìˆ˜ì •

### **ì˜ì¡´ì„± ë™ê¸°í™”**

```bash
# requirements.txtë¥¼ ìˆ˜ì •í•œ ê²½ìš°, CIê°€ ìë™ìœ¼ë¡œ pyproject.toml ë™ê¸°í™”
# PRì— ìë™ ì»¤ë°‹ë¨
```

### **ë¡œì»¬ì—ì„œ pyproject.toml ì—…ë°ì´íŠ¸**

```bash
# í˜„ì¬ ì„¤ì¹˜ëœ íŒ¨í‚¤ì§€ë¥¼ pyproject.tomlì— ë°˜ì˜
python scripts/freeze-to-pyproject.py
```

---

## ğŸ› ï¸ ê°œë°œ ê°€ì´ë“œ

### **ë¡œì»¬ ê°œë°œ í™˜ê²½ ì„¤ì •**

```bash
# 1. ê°€ìƒí™˜ê²½ ìƒì„±
python3 -m venv venv
source venv/bin/activate

# 2. ì˜ì¡´ì„± ì„¤ì¹˜
pip install -r ai_app/requirements.txt

# 3. ê°œë°œ ì˜ì¡´ì„± ì„¤ì¹˜
pip install -e ".[dev]"

# 4. ì„œë¹„ìŠ¤ ì‹¤í–‰
cd ai_app
uvicorn api.main:app --reload --port 8000
```

### **ì˜ì¡´ì„± ì¶”ê°€**

```bash
# 1. pyproject.tomlì— ì¶”ê°€
[project]
dependencies = [
    "new-package>=1.0.0",
    ...
]

# 2. ë¡œì»¬ ì„¤ì¹˜
pip install new-package

# 3. requirements.txt ì—…ë°ì´íŠ¸ (ì„ íƒ)
pip freeze | grep new-package >> ai_app/requirements.txt

# 4. ì»¤ë°‹ & í‘¸ì‹œ (CIê°€ ìë™ ë™ê¸°í™”)
```

---

## ğŸ¥ í—¬ìŠ¤ì²´í¬

### **ì—”ë“œí¬ì¸íŠ¸**

```bash
# ê¸°ë³¸ í—¬ìŠ¤ì²´í¬
curl http://localhost:8000/api/ai/health

# ì‘ë‹µ (ì„±ê³µ)
{"status": "ok"}

# ì‘ë‹µ (ì‹¤íŒ¨)
{"detail": "Not Found"}  # ë˜ëŠ” 500 ì—ëŸ¬
```

### **ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸**

```bash
# PM2 ìƒíƒœ
pm2 status ai-service

# ë¡œê·¸ í™•ì¸
pm2 logs ai-service --lines 50

# ì—ëŸ¬ ë¡œê·¸
tail -f /home/ubuntu/refit/logs/ai/error.log
```

---

## ğŸš¨ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### **ë°°í¬ ì‹¤íŒ¨**

1. **pip install íƒ€ì„ì•„ì›ƒ**
   - SSM íƒ€ì„ì•„ì›ƒ: 30ë¶„ (1800ì´ˆ)
   - í° íŒ¨í‚¤ì§€ (torch, spacy) ì„¤ì¹˜ ì‹œê°„ ê³ ë ¤

2. **ì˜ì¡´ì„± ì¶©ëŒ**
   - `grpcio` ë²„ì „ ê³ ì •: 1.60~1.70
   - `pyproject.toml`ì—ì„œ ë²„ì „ ë²”ìœ„ ì¡°ì •

3. **í¬íŠ¸ ì¶©ëŒ (Errno 98)**
   - CDê°€ ìë™ìœ¼ë¡œ í¬íŠ¸ 8000 ì •ë¦¬
   - PM2 í”„ë¡œì„¸ìŠ¤ ì™„ì „ ì •ë¦¬ ë¡œì§ í¬í•¨

### **ë¡¤ë°± ì‹¤íŒ¨**

1. **ë°±ì—… ì—†ìŒ**
   - ìµœì†Œ 1íšŒ ì„±ê³µ ë°°í¬ í•„ìš”
   - Safety backupìœ¼ë¡œ ì„ì‹œ ë³µêµ¬

2. **ì˜ì¡´ì„± ë¶ˆì¼ì¹˜**
   - `Restore dependencies: true` ì‚¬ìš©
   - Wheel íŒ¨í‚¤ì§€ í•¨ê»˜ ë³µì›

3. **í—¬ìŠ¤ì²´í¬ ì‹¤íŒ¨**
   - PM2 ë¡œê·¸ í™•ì¸: `pm2 logs ai-service`
   - ì„œë²„ ì—ëŸ¬ ë¡œê·¸: `/home/ubuntu/refit/logs/ai/error.log`

---

## ğŸ“Š ë°±ì—… ê´€ë¦¬

### **ìë™ ë°±ì—…**

- **ë°°í¬ ì‹œ**: ì½”ë“œ + Wheel ìë™ ë°±ì—…
- **ë³´ê´€ ê¸°ê°„**: 7ì¼ (ìë™ ì‚­ì œ)
- **ìœ„ì¹˜**: `/home/ubuntu/refit/backups/ai/`

### **ë°±ì—… êµ¬ì¡°**

```
/home/ubuntu/refit/backups/ai/
â”œâ”€â”€ code_20260128100000/      # ì½”ë“œ ë°±ì—…
â”‚   â””â”€â”€ ai_app/
â”œâ”€â”€ wheel_20260128100000/     # Wheel ë°±ì—…
â”‚   â””â”€â”€ refit_ai_service-0.1.0-py3-none-any.whl
â””â”€â”€ safety_before_rollback_*/  # ì„ì‹œ ë°±ì—… (ë¡¤ë°± ì‹œ)
```

---

## ğŸ” í™˜ê²½ ë³€ìˆ˜

### **GitHub Secrets**

| Secret | ì„¤ëª… |
|--------|------|
| `AWS_ACCESS_KEY_ID` | AWS ì¸ì¦ |
| `AWS_SECRET_ACCESS_KEY` | AWS ì¸ì¦ |
| `EC2_INSTANCE_ID` | ë°°í¬ ëŒ€ìƒ EC2 |
| `S3_ARTIFACTS_BUCKET` | Wheel ì €ì¥ S3 |
| `SERVER_BASE_PATH` | ì„œë²„ ê¸°ë³¸ ê²½ë¡œ |
| `HEALTH_CHECK_URL` | í—¬ìŠ¤ì²´í¬ URL |
| `DISCORD_WEBHOOK` | ì•Œë¦¼ ì›¹í›… |

### **ì„œë²„ í™˜ê²½ë³€ìˆ˜ (.env)**

```bash
# /home/ubuntu/refit/app/ai/.env
GEMINI_API_KEY=your_api_key
DATABASE_URL=postgresql://...
```

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ

### **CD ìŠ¤ëª¨í¬ í…ŒìŠ¤íŠ¸**

ë°°í¬ í›„ ìë™ìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ” ê¸°ë³¸ ì„±ëŠ¥ ê²€ì¦ (SLI/SLO ê¸°ë°˜)

#### **í…ŒìŠ¤íŠ¸ í•­ëª©**

| í•­ëª© | API | SLO ëª©í‘œ | ê²€ì¦ ë°©ë²• |
|------|-----|----------|-----------|
| **ê¸°ë³¸ í—¬ìŠ¤ì²´í¬** | `GET /api/ai/health` | 200 OK | ìµœëŒ€ 10íšŒ ì¬ì‹œë„ |
| **ì¶”ì²œ API** | `POST /api/ai/recommendations` | P95 < 3ì´ˆ | ì‘ë‹µ ì‹œê°„ ì¸¡ì • |
| **ì‘ë‹µ í˜•ì‹** | - | JSON êµ¬ì¡° | status í•„ë“œ í™•ì¸ |

#### **í…ŒìŠ¤íŠ¸ í”Œë¡œìš°**

```
ë°°í¬ ì™„ë£Œ
    â†“
ì„œë¹„ìŠ¤ ì´ˆê¸°í™” ëŒ€ê¸° (10ì´ˆ)
    â†“
ê¸°ë³¸ í—¬ìŠ¤ì²´í¬ (ìµœëŒ€ 10íšŒ)
    â†“
âœ… ì„±ê³µ â†’ ìŠ¤ëª¨í¬ í…ŒìŠ¤íŠ¸ ì‹œì‘
âŒ ì‹¤íŒ¨ â†’ ìë™ ë¡¤ë°±
    â†“
ì¶”ì²œ API í˜¸ì¶œ & ì‘ë‹µ ì‹œê°„ ì¸¡ì •
    â†“
ì‘ë‹µ í˜•ì‹ ê²€ì¦
    â†“
âœ… ëª¨ë‘ í†µê³¼ â†’ ë°°í¬ ì™„ë£Œ
âš ï¸  SLO ì´ˆê³¼ â†’ ê²½ê³  í‘œì‹œ (ë°°í¬ëŠ” ê³„ì†)
âŒ ì‹¤íŒ¨ â†’ ìë™ ë¡¤ë°±
```

#### **ìŠ¤ëª¨í¬ í…ŒìŠ¤íŠ¸ ê²°ê³¼ ì˜ˆì‹œ**

```bash
âœ… ê¸°ë³¸ í—¬ìŠ¤ì²´í¬ ì„±ê³µ! (HTTP 200)

============================================
SLO ìŠ¤ëª¨í¬ í…ŒìŠ¤íŠ¸ ì‹œì‘
============================================

ğŸ“Š Test 1/2: ì¶”ì²œ API ê²€ì¦...
  âœ… ì¶”ì²œ API: 2.34ì´ˆ (ëª©í‘œ: < 3ì´ˆ, SLO ë‹¬ì„±)

ğŸ“Š Test 2/2: í—¬ìŠ¤ì²´í¬ ìƒì„¸ ì‘ë‹µ ê²€ì¦...
  âœ… í—¬ìŠ¤ì²´í¬ ì‘ë‹µ í˜•ì‹ ì •ìƒ

============================================
âœ… ìŠ¤ëª¨í¬ í…ŒìŠ¤íŠ¸ í†µê³¼!
============================================
```

---

### **ë¡¤ë°± í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ**

ë¡¤ë°± ì›Œí¬í”Œë¡œìš° ë™ì‘ì„ ê²€ì¦í•˜ëŠ” ë°©ë²•

#### **ì‚¬ì „ ì¤€ë¹„**

1. **ìµœì†Œ 1íšŒ ì´ìƒ ì„±ê³µí•œ ë°°í¬ í•„ìš”**
   - ë°±ì—… ìƒì„±ì„ ìœ„í•´ í•„ìˆ˜
   - ì—†ìœ¼ë©´ ë¡¤ë°± ë¶ˆê°€

2. **ë°±ì—… ì¡´ì¬ í™•ì¸**
   ```bash
   # ì„œë²„ì—ì„œ í™•ì¸
   ls -lt /home/ubuntu/refit/backups/ai/
   
   # ë˜ëŠ” GitHub Actionsì—ì„œ
   # Rollback ì›Œí¬í”Œë¡œìš° â†’ Mode: list
   ```

#### **í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤**

##### **Scenario 1: ë°±ì—… ëª©ë¡ ì¡°íšŒ**

```yaml
# GitHub Actions â†’ AI Service Rollback
Mode: list
```

**ì˜ˆìƒ ì¶œë ¥:**
```
ğŸ“‚ Available Code Backups (Latest 10):
  - code_20260128104517 (Jan 28 10:45)
  - code_20260128104029 (Jan 28 10:40)
  ...

ğŸ“¦ Available Wheel Backups (Latest 10):
  - wheel_20260128104517 (Jan 28 10:45)
  - wheel_20260128104029 (Jan 28 10:40)
  ...

ğŸ’¡ Usage:
  - Use the same timestamp for code and wheel
  - Format: 20260128104517
```

**ê²€ì¦:**
- âœ… ë°±ì—… ëª©ë¡ì´ í‘œì‹œë¨
- âœ… codeì™€ wheelì´ ë™ì¼í•œ timestampë¡œ ë§¤ì¹­ë¨
- âœ… ìµœê·¼ 10ê°œë§Œ í‘œì‹œë¨

---

##### **Scenario 2: ìµœì‹  ë°±ì—…ìœ¼ë¡œ ë¡¤ë°± (ê¸°ë³¸)**

```yaml
# GitHub Actions â†’ AI Service Rollback
Mode: restore
Backup ID: (ë¹„ì›€)  # ìë™ìœ¼ë¡œ ìµœì‹  ë°±ì—… ì„ íƒ
Restore dependencies: true
```

**ì˜ˆìƒ í”Œë¡œìš°:**
```
ë°±ì—… í™•ì¸
    â†“
Safety Backup ìƒì„± (í˜„ì¬ ìƒíƒœ ì„ì‹œ ë°±ì—…)
    â†“
PM2 í”„ë¡œì„¸ìŠ¤ ì™„ì „ ì •ë¦¬
    â†“
ì½”ë“œ ë³µì›
    â†“
Wheel ì¬ì„¤ì¹˜ (ì˜ì¡´ì„± ë³µì›)
    â†“
PM2 ì¬ì‹œì‘
    â†“
í—¬ìŠ¤ì²´í¬ (ìµœëŒ€ 10íšŒ, ì ì§„ì  ëŒ€ê¸°)
    â†“
âœ… ì„±ê³µ â†’ Safety backup ì‚­ì œ
âŒ ì‹¤íŒ¨ â†’ Safety backupìœ¼ë¡œ ìë™ ë³µêµ¬
```

**ê²€ì¦ í•­ëª©:**
- âœ… Safety backup ìƒì„±ë¨
- âœ… ì´ì „ ì½”ë“œë¡œ ë³µì›ë¨
- âœ… ì˜ì¡´ì„±ë„ ë³µì›ë¨ (wheel ì¬ì„¤ì¹˜)
- âœ… PM2 í”„ë¡œì„¸ìŠ¤ online
- âœ… í—¬ìŠ¤ì²´í¬ 200 OK
- âœ… Discord ì•Œë¦¼ ë°œì†¡
- âœ… Safety backup ìë™ ì‚­ì œ

---

##### **Scenario 3: íŠ¹ì • ë²„ì „ìœ¼ë¡œ ë¡¤ë°±**

```yaml
Mode: restore
Backup ID: 20260127150000  # íŠ¹ì • timestamp
Restore dependencies: true
```

**ê²€ì¦:**
- âœ… ì§€ì •í•œ timestampì˜ ë°±ì—… ì‚¬ìš©ë¨
- âœ… ì½”ë“œì™€ wheelì´ ë™ì¼ timestampì—ì„œ ë³µì›ë¨

---

##### **Scenario 4: ì½”ë“œë§Œ ë¡¤ë°± (ì˜ì¡´ì„± ì œì™¸)**

```yaml
Mode: restore
Backup ID: 20260128104517
Restore dependencies: false  âš ï¸
```

**ê²½ê³ :**
- âš ï¸ í˜„ì¬ venv ìœ ì§€ (ì˜ì¡´ì„± ë³€ê²½ ì—†ìŒ)
- âš ï¸ ì´ì „ ì½”ë“œ + ìƒˆ ì˜ì¡´ì„± = í˜¸í™˜ ë¬¸ì œ ê°€ëŠ¥!

**ì‚¬ìš© ì‹œì :**
- ì˜ì¡´ì„± ë³€ê²½ì´ ì—†ì—ˆë˜ ë°°í¬ë§Œ ë¡¤ë°±í•  ë•Œ
- ì½”ë“œ ë²„ê·¸ë§Œ ìˆ˜ì •í•  ë•Œ

**ê²€ì¦:**
- âœ… ì½”ë“œë§Œ ë³µì›ë¨
- âœ… pip list í™•ì¸ â†’ ì˜ì¡´ì„± ë³€ê²½ ì—†ìŒ

---

##### **Scenario 5: ë¡¤ë°± ì‹¤íŒ¨ í›„ ìë™ ë³µêµ¬**

**í…ŒìŠ¤íŠ¸ ë°©ë²•:**
1. ì˜ë„ì ìœ¼ë¡œ ì˜ëª»ëœ backup_id ì…ë ¥
2. ë˜ëŠ” ë°±ì—… ë””ë ‰í† ë¦¬ ê¶Œí•œ ë³€ê²½

**ì˜ˆìƒ í”Œë¡œìš°:**
```
ë¡¤ë°± ì‹œë„
    â†“
âŒ ë°±ì—… ë³µì› ì‹¤íŒ¨ (ê¶Œí•œ ì˜¤ë¥˜ ë“±)
    â†“
í—¬ìŠ¤ì²´í¬ ì‹¤íŒ¨ (10íšŒ)
    â†“
Safety backupìœ¼ë¡œ ìë™ ë³µêµ¬ ì‹œë„
    â†“
âœ… ì›ë˜ ìƒíƒœë¡œ ë³µêµ¬
ë˜ëŠ”
âŒ ìˆ˜ë™ ê°œì… í•„ìš”
```

**ê²€ì¦:**
- âœ… Safety backupì´ ìë™ìœ¼ë¡œ ë³µêµ¬ ì‹œë„
- âœ… PM2 ë¡œê·¸ ìë™ ì¶œë ¥
- âœ… ìƒì„¸í•œ ë””ë²„ê·¸ ì •ë³´ í‘œì‹œ
- âœ… Discord ë¡¤ë°± ì‹¤íŒ¨ ì•Œë¦¼ (ì—†ìŒ, ë°°í¬ ì‹¤íŒ¨ë§Œ)

---

#### **ë¡¤ë°± í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸**

| í•­ëª© | í…ŒìŠ¤íŠ¸ ë°©ë²• | ì˜ˆìƒ ê²°ê³¼ | ìƒíƒœ |
|------|------------|-----------|------|
| **ë°±ì—… ëª©ë¡ ì¡°íšŒ** | Mode: list | ë°±ì—… ëª©ë¡ í‘œì‹œ | â˜ |
| **ìµœì‹  ë°±ì—… ë¡¤ë°±** | Backup ID ë¹„ì›€ | ìë™ ì„ íƒ & ì„±ê³µ | â˜ |
| **íŠ¹ì • ë°±ì—… ë¡¤ë°±** | Backup ID ì§€ì • | ì§€ì • ë²„ì „ ë³µì› | â˜ |
| **ì˜ì¡´ì„± ë³µì›** | restore_dependencies: true | wheel ì¬ì„¤ì¹˜ | â˜ |
| **ì½”ë“œë§Œ ë¡¤ë°±** | restore_dependencies: false | venv ìœ ì§€ | â˜ |
| **Safety backup** | - | ìë™ ìƒì„± & ì‚­ì œ | â˜ |
| **ìë™ ë³µêµ¬** | ë¡¤ë°± ì‹¤íŒ¨ ìœ ë„ | Safety backup ë³µêµ¬ | â˜ |
| **PM2 í”„ë¡œì„¸ìŠ¤ ì •ë¦¬** | - | ëª¨ë“  ai-* ì •ë¦¬ | â˜ |
| **í—¬ìŠ¤ì²´í¬** | - | 10íšŒ ì¬ì‹œë„, ì ì§„ì  ëŒ€ê¸° | â˜ |
| **Discord ì•Œë¦¼** | - | ë¡¤ë°± ì„±ê³µ/ì‹¤íŒ¨ ì•Œë¦¼ | â˜ |

---

#### **ë¡¤ë°± í›„ í™•ì¸ ì‚¬í•­**

```bash
# 1. PM2 ìƒíƒœ í™•ì¸
pm2 status ai-service
# â†’ online ìƒíƒœ í™•ì¸

# 2. ì„œë¹„ìŠ¤ ë²„ì „ í™•ì¸
curl http://localhost:8000/api/ai/health
# â†’ ì‘ë‹µ í™•ì¸

# 3. PM2 ë¡œê·¸ í™•ì¸
pm2 logs ai-service --lines 20
# â†’ ì—ëŸ¬ ì—†ëŠ”ì§€ í™•ì¸

# 4. ë°±ì—… ë””ë ‰í† ë¦¬ í™•ì¸
ls -lt /home/ubuntu/refit/backups/ai/
# â†’ Safety backupì´ ì‚­ì œë˜ì—ˆëŠ”ì§€ í™•ì¸

# 5. ì˜ì¡´ì„± í™•ì¸ (restore_dependencies: trueì¸ ê²½ìš°)
source /home/ubuntu/refit/app/ai/venv/bin/activate
pip list | grep sentence-transformers
# â†’ ì´ì „ ë²„ì „ìœ¼ë¡œ ë³µì›ë˜ì—ˆëŠ”ì§€ í™•ì¸
```

---

#### **ë¡¤ë°± ì‹¤íŒ¨ ì‹œ ìˆ˜ë™ ë³µêµ¬**

ë¡¤ë°±ì´ ì™„ì „íˆ ì‹¤íŒ¨í•œ ê²½ìš° (ë“œë¬¼ì§€ë§Œ ë°œìƒ ê°€ëŠ¥)

```bash
# 1. Safety backup í™•ì¸
ls -lt /home/ubuntu/refit/backups/ai/safety_*

# 2. Safety backupìœ¼ë¡œ ìˆ˜ë™ ë³µì›
sudo cp -r /home/ubuntu/refit/backups/ai/safety_before_rollback_*/ai_app \
  /home/ubuntu/refit/app/ai/

# 3. ê¶Œí•œ ë³µêµ¬
sudo chown -R ubuntu:ubuntu /home/ubuntu/refit/app/ai/

# 4. PM2 ì¬ì‹œì‘
pm2 stop ai-service
pm2 delete ai-service
pm2 start /home/ubuntu/refit/infra/pm2/ecosystem.ai.config.js --only ai-service

# 5. í—¬ìŠ¤ì²´í¬
curl http://localhost:8000/api/ai/health
```

---

#### **ë¡¤ë°± í…ŒìŠ¤íŠ¸ ì£¼ì˜ì‚¬í•­**

1. **í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œ í…ŒìŠ¤íŠ¸ ê¸ˆì§€**
   - ìŠ¤í…Œì´ì§• í™˜ê²½ì—ì„œë§Œ í…ŒìŠ¤íŠ¸
   - ë˜ëŠ” íŠ¸ë˜í”½ì´ ì ì€ ì‹œê°„ëŒ€ (ìƒˆë²½)

2. **ë°±ì—… íƒ€ì„ìŠ¤íƒ¬í”„ í™•ì¸**
   - codeì™€ wheelì˜ timestampê°€ ë™ì¼í•´ì•¼ í•¨
   - ë‹¤ë¥´ë©´ ì˜ì¡´ì„± ë¶ˆì¼ì¹˜ ê°€ëŠ¥

3. **Safety backup ìš©ëŸ‰**
   - ë¡¤ë°±ë§ˆë‹¤ í˜„ì¬ ìƒíƒœ ë°±ì—…
   - ë””ìŠ¤í¬ ê³µê°„ í™•ì¸ í•„ìš”

4. **Discord ì•Œë¦¼ í™•ì¸**
   - ë¡¤ë°± ì§„í–‰ ì¤‘ ì•Œë¦¼ í™•ì¸
   - ì„±ê³µ/ì‹¤íŒ¨ ìƒíƒœ í™•ì¸

---

## ğŸ”¬ ë¶€í•˜í…ŒìŠ¤íŠ¸ (í–¥í›„ êµ¬í˜„ ì˜ˆì •)

### **Phase 2: Prometheus ë©”íŠ¸ë¦­ ìˆ˜ì§‘**

ë¶€í•˜í…ŒìŠ¤íŠ¸ì™€ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ì„ ìœ„í•œ ë©”íŠ¸ë¦­ ì¸í”„ë¼ êµ¬ì¶•

**êµ¬í˜„ í•­ëª©:**
1. FastAPI Prometheus ë¯¸ë“¤ì›¨ì–´
2. ìš”ì²­/ì‘ë‹µ ë©”íŠ¸ë¦­ ìˆ˜ì§‘
3. P50, P95, P99 ì¸¡ì •
4. /metrics ì—”ë“œí¬ì¸íŠ¸ ë…¸ì¶œ

**ì°¸ê³  ë¬¸ì„œ:**
- SLI/SLO ì„¤ê³„ ë¬¸ì„œ (Section 9.2)
- Prometheus Python Client

---

### **Phase 3: ë¶€í•˜í…ŒìŠ¤íŠ¸ ì„¤ê³„**

SLO ëª©í‘œ ë‹¬ì„± ì—¬ë¶€ë¥¼ ê²€ì¦í•˜ëŠ” ë¶€í•˜í…ŒìŠ¤íŠ¸

**í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤:**
1. **ì¶”ì²œ API ë¶€í•˜**
   - 100íšŒ ìš”ì²­, ë™ì‹œ 5ê°œ
   - P95 < 3ì´ˆ ê²€ì¦
   - ì„±ê³µë¥  > 97% ê²€ì¦

2. **ë¬¸ì„œ ë¶„ì„ ë¶€í•˜**
   - 50íšŒ ìš”ì²­, ë™ì‹œ 3ê°œ
   - P95 < 30ì´ˆ ê²€ì¦
   - ì„±ê³µë¥  > 93% ê²€ì¦

3. **ë¦¬í¬íŠ¸ ìƒì„± ë¶€í•˜**
   - 20íšŒ ìš”ì²­, ë™ì‹œ 2ê°œ
   - P95 < 70ì´ˆ ê²€ì¦
   - ì„±ê³µë¥  > 93% ê²€ì¦

**ë„êµ¬ ì„ íƒ:**
- `hey` (ê°„ë‹¨, CLI)
- `k6` (ê°•ë ¥, JS)
- `locust` (Python, UI)

---

### **Phase 4: CD ë©”íŠ¸ë¦­ ê¸°ë°˜ ê²€ì¦**

Prometheus ë©”íŠ¸ë¦­ì„ í™œìš©í•œ ìë™í™”ëœ SLO ê²€ì¦

```yaml
# CD ì›Œí¬í”Œë¡œìš°
- name: Verify SLO Metrics
  run: |
    # ë°°í¬ í›„ ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ëŒ€ê¸° (5ë¶„)
    sleep 300
    
    # Prometheusì—ì„œ P95 ì¡°íšŒ
    P95=$(curl -s "http://prometheus:9090/api/v1/query?query=refit:ai_latency:p95:1m{endpoint='/api/ai/recommendations'}" | jq -r '.data.result[0].value[1]')
    
    # SLO ê²€ì¦
    if (( $(echo "$P95 > 3.0" | bc -l) )); then
      echo "âŒ SLO ë¯¸ë‹¬ì„±: P95=${P95}ì´ˆ"
      exit 1
    fi
    
    echo "âœ… SLO ë‹¬ì„±: P95=${P95}ì´ˆ"
```

---

## ğŸ“Š ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ (í–¥í›„)

### **Grafana ëŒ€ì‹œë³´ë“œ (Phase 3 ì´í›„)**

**êµ¬ì„± ì˜ˆì •:**
1. AI Performance Dashboard
2. AI Quality Dashboard
3. AI Cost Dashboard
4. Error Budget Dashboard

**ë©”íŠ¸ë¦­ ì˜ˆì‹œ:**
- `refit:ai_availability:1m` - ê°€ìš©ì„±
- `refit:ai_latency:p95:1m` - P95 ì§€ì—°ì‹œê°„
- `refit:ai_completion_rate:1m` - ì²˜ë¦¬ ì„±ê³µë¥ 
- `refit:error_budget:burn_rate:28d` - Error Budget ì†Œì§„ìœ¨

---

## ğŸ“ ë¬¸ì˜

- **íŒ€**: Re-Fit DevOps
- **Repository**: https://github.com/100-hours-a-week/19-team-project-ai
